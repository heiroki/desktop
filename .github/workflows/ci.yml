name: CI

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  python-lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          
      - name: Install Python dependencies
        working-directory: ./backend
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          
      - name: Run Python linter (ruff)
        working-directory: ./backend
        run: ruff check .

  # python-test:
  #   runs-on: ubuntu-latest
    
  #   steps:
  #     - uses: actions/checkout@v4
      
  #     - name: Setup database
  #       run: docker compose up -d --wait db
        
  #     - name: Setup Python
  #       uses: actions/setup-python@v5
  #       with:
  #         python-version: '3.11'
          
  #     - name: Install Python dependencies
  #       working-directory: ./backend
  #       run: |
  #         python -m pip install --upgrade pip
  #         pip install -r requirements.txt
        
  #     - name: Run Python tests
  #       working-directory: ./backend
  #       env:
  #         PYTHONPATH: .
  #         DATABASE_URL: postgresql://myuser:postgres@localhost:15432/project
  #       run: pytest -v

  flutter-lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.29.2'
          channel: 'stable'
          architecture: x64
          
      - name: Get Flutter dependencies
        working-directory: ./frontend
        run: flutter pub get
        
      - name: Run Flutter analyze
        working-directory: ./frontend
        run: flutter analyze

  # flutter-test:
  #   runs-on: ubuntu-latest
  #   steps:
  #     - uses: actions/checkout@v4
       
  #     - name: Setup Flutter
  #       uses: subosito/flutter-action@v2
  #       with:
  #         channel: 'stable'
  #         architecture: x64
         
  #     - name: Get Flutter dependencies
  #       working-directory: ./frontend
  #       run: flutter pub get
       
  #     - name: Run Flutter tests  
  #       working-directory: ./frontend
  #       run: flutter test
